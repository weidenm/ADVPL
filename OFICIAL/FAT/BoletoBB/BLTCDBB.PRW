#INCLUDE "RWMAKE.CH"
#include "protheus.ch"
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³ BLTCDBB  ³ Autor ³ Microsiga             ³ Data ³ 20/03/07 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri??o ³ IMPRESSAO DO BOLETO BANCO BRASIL COM CODIGO DE BARRAS      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ 12.1.25  ³ 				  											  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
User Function BLTCDBB()

	PRIVATE lExec    := .F.
	PRIVATE cIndexName := ''
	PRIVATE cIndexKey  := ''
	PRIVATE cFilter    := ''
	PRIVATE cSemBol := ''

	Tamanho  := "M"
	titulo   := "Impressao de Boleto com Codigo de Barras-Banco do Brasil"
	cDesc1   := "Este programa destina-se a impressao do Boleto com Codigo de Barras."
	cDesc2   := ""
	cDesc3   := ""
	cString  := "SE1"
	wnrel    := "BOLETO"
	lEnd     := .F.
	cPerg     :="BLTBAR"
	aReturn  := {"Zebrado", 1,"Administracao", 2, 2, 1, "",1 }   
	nLastKey := 0
	
	dbSelectArea("SE1")
		
	If !Pergunte (cPerg,.T.)
	   Return
	EndIf

	//O Boleto Bancário na Empresa Plinc será gerado por Carga ou por N. de Nota Fiscal
	//Se MV_PAR01 == 1 Por Carga / Se MV_PAR02 == 2 Por Nota Fiscal
	If MV_PAR01 == 1
		
		IF Select("QDAI") <> 0
			DbSelectArea("QDAI")
			DbCloseArea()
		EndIf        
		
		cQuery := "SELECT DAI_COD, DAI_NFISCA, DAI_SERIE "
		cQuery += "FROM "+RetSqlName("DAI")+" "
		cQuery += "WHERE DAI_FILIAL = '"+xFilial("DAI")+"' AND D_E_L_E_T_ = '' AND DAI_COD BETWEEN '"+MV_PAR06+"' AND '"+MV_PAR07+"' "
		cQuery += "ORDER BY DAI_COD, DAI_NFISCA"
		cQuery := ChangeQuery(cQuery)
		dbUseArea(.T.,"QDAI",TcGenQry(,,cQuery),"QDAI",.T.,.T.)

		DbGoTop()
		cNotaDe := QDAI->DAI_NFISCA
		cSerieDe := QDAI->DAI_SERIE
		Do While !Eof()
			cNotaAte := QDAI->DAI_NFISCA
			cSerieAte := QDAI->DAI_SERIE
			DbSkip()
		Enddo

	Elseif MV_PAR01 == 2
		IF Select("QSA1") <> 0
			DbSelectArea("QSA1")
			DbCloseArea()
		EndIf        
		
		cQuery := "SELECT A1_COD, A1_LOJA "
		cQuery += "FROM "+RetSqlName("SA1")+" A INNER JOIN "+RetSqlName("SE1")+" B ON A.A1_COD = B.E1_CLIENTE "
		cQuery += "WHERE B.E1_FILIAL = '"+xFilial("SE1")+"' AND B.D_E_L_E_T_ = '' AND A.A1_BOLETO = '2' AND B.E1_NUM BETWEEN '"+MV_PAR02+"' AND '"+MV_PAR03+"' "
		cQuery += " group by  A1_COD, A1_LOJA"
		cQuery := ChangeQuery(cQuery)
		conout(cQuery)
		dbUseArea(.T.,"QSA1",TcGenQry(,,cQuery),"QSA1",.T.,.T.)

		DbGoTop()
		Do While !Eof()
			if Alltrim(cSemBol)<>""
				cSemBol := cSemBol + "/" + QSA1->A1_COD
			else
				cSemBol := QSA1->A1_COD
			EndIf
			conout(cSemBol)
			DbSkip()
		Enddo

		
		cNotaDe := MV_PAR02
		cNotaAte := MV_PAR03
		cSerieDe := MV_PAR04
		cSerieAte := MV_PAR05
	
	Endif
	
	LimpaFlag(cNotaDe,cNotaAte,cSerieDe,cSerieAte)		
		
	cIndexName := Criatrab(Nil,.F.)
	cIndexKey  := "E1_PREFIXO + E1_NUM + E1_PARCELA + E1_TIPO + DTOS(E1_EMISSAO) + E1_PORTADO + E1_CLIENTE"
	cFilter	   += "E1_FILIAL == '"+xFilial("SE1")+"' "
	cFilter    += ".And. E1_SALDO > 0 "
	cFilter	   += " .And. E1_PREFIXO >= '"+cSerieDe+"' .And. E1_PREFIXO <= '"+cSerieAte+"' .And." 
	cFilter	   += "E1_NUM >= '"+cNotaDe+"' .And. E1_NUM <= '"+cNotaAte+"' .And. "
	cFilter	   += "  E1_VENCTO > E1_EMISSAO .and. "  
	if Alltrim(cSemBol)<>""
		cFilter	   += " !E1_CLIENTE$'"+cSemBol+"' .and. "  
	EndIf
	cFilter	   += "!(E1_TIPO$MVABATIM)" //.And."
	//cFilter	   += "E1_PARCELA>='" + MV_PAR05 + "'.And.E1_PARCELA<='" + MV_PAR06 + "'.And."
	//cFilter	   += "E1_PORTADO>='" + MV_PAR07 + "'.And.E1_PORTADO<='" + MV_PAR08 + "'.And."
	//cFilter	   += "E1_CLIENTE>='" + MV_PAR09 + "'.And.E1_CLIENTE<='" + MV_PAR10 + "'.And."
	//cFilter	   += "E1_LOJA>='" + MV_PAR11 + "'.And.E1_LOJA<='"+MV_PAR12+"'.And."
	//cFilter	   += "DTOS(E1_EMISSAO)>='"+DTOS(mv_par13)+"'.and.DTOS(E1_EMISSAO)<='"+DTOS(mv_par14)+"'.And."
	//cFilter	   += 'DTOS(E1_VENCREA)>="'+DTOS(mv_par15)+'".and.DTOS(E1_VENCREA)<="'+DTOS(mv_par16)+'".And.'
	//cFilter	   += "E1_NUMBOR>='" + MV_PAR17 + "'.And.E1_NUMBOR<='" + MV_PAR18 + "'.And."
	//cFilter		+= "E1_PORTADO<>'   '"
	
	IndRegua("SE1", cIndexName, cIndexKey,, cFilter, "Aguarde selecionando registros....")
	DbSelectArea("SE1")
	
	#IFNDEF TOP
		DbSetIndex(cIndexName + OrdBagExt())
	#ENDIF
	dbGoTop()
	@ 001,001 TO 400,700 DIALOG oDlg TITLE "Seleção de Titulos"
	@ 001,001 TO 170,350 BROWSE "SE1" MARK "E1_OK"
	@ 180,310 BMPBUTTON TYPE 01 ACTION (lExec := .T.,Close(oDlg))
	@ 180,280 BMPBUTTON TYPE 02 ACTION (lExec := .F.,Close(oDlg))
	ACTIVATE DIALOG oDlg CENTERED
		
	dbGoTop()
	If lExec
		Processa({|lEnd|MontaRel()})
	Endif
	RetIndex("SE1")
	Ferase(cIndexName+OrdBagExt())

Return Nil

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³  MontaRel³ Autor ³ Microsiga             ³ Data ³ 13/10/03 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri??o ³ IMPRESSAO DO BOLETO LASER COM CODIGO DE BARRAS			     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³ Especifico para Clientes Microsiga                         ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function MontaRel()

	LOCAL oPrint
	LOCAL nX := 0
	Local cNroDoc :=  " "                                   

	LOCAL aDadosEmp := {AllTrim(SM0->M0_NOMECOM),;	//[1]Nome da Empresa
						AllTrim(SM0->M0_ENDCOB),;	//[2]Endereço
						AllTrim(SM0->M0_BAIRCOB)+", "+AllTrim(SM0->M0_CIDCOB)+", "+SM0->M0_ESTCOB,;	//[3]Complemento
						"CEP: "+Subs(SM0->M0_CEPCOB,1,5)+"-"+Subs(SM0->M0_CEPCOB,6,3),;	//[4]CEP
						"PABX/FAX: "+SM0->M0_TEL,;	//[5]Telefones
						"CNPJ: "+Subs(SM0->M0_CGC,1,2)+"."+Subs(SM0->M0_CGC,3,3)+"."+Subs(SM0->M0_CGC,6,3)+"/"+Subs(SM0->M0_CGC,9,4)+"-"+Subs(SM0->M0_CGC,13,2),;	//[6]CGC
						"I.E.: "+Subs(SM0->M0_INSC,1,3)+"."+Subs(SM0->M0_INSC,4,3)+"."+Subs(SM0->M0_INSC,7,3)+"."+Subs(SM0->M0_INSC,10,3)}	//[7]I.E
	
	LOCAL aDadosTit
	LOCAL aDadosBanco
	LOCAL aDatSacado
/*	LOCAL aBolText     := {"Após o vencimento cobrar multa de R$ ",;
						   "Sujeito a Protesto após 05 (cinco) dias do vencimento",;
						   "ATENÇÃO: Deposito bancário não quita título."}*/
	
	Local aBolText  := {"","",""}					   
	LOCAL nI        := 1
	LOCAL aCB_RN_NN := {}
	LOCAL nVlrAbat	:= 0
	
	oPrint:= TMSPrinter():New("Boleto Laser")
	oPrint:Setup()
	oPrint:SetPortrait()	//ou SetLandscape()
	oPrint:StartPage()   	//Inicia uma nova página

	DbSelectArea("SE1")
	dbGotop()
	
	ProcRegua(RecCount())
	
	While SE1->(!EOF()) 
	
		IncProc()
		
		//Quando nao estiver selecionado despreza o registro
	    If !Marked("E1_OK")
	       DbSkip()
	       Loop
	    EndIf  

/*	    IF  ALLTRIM(SE1->E1_PORTADO) <> ""
	       If ALLTRIM(SE1->E1_PORTADO) # "001" .And. ALLTRIM(SE1->E1_PORTADO) # "000"
	          DbSkip()
	          Loop
	       EndIf 
	    EndIf*/
    
		//Posiciona o SA6 (Bancos)
		DbSelectArea("SA6")
		DbSetOrder(1)
//	   	DbSeek(xFilial("SA6")+SE1->E1_PORTADO+SE1->E1_AGEDEP+SE1->E1_CONTA,.T.)
		DbSeek(xFilial("SA6")+"001"+"0365 "+"0000044946",.T.)
	
	if SA6->A6_COD <> "001" 
		Alert("Banco do Brasil não encontrado. Favor informar administrador.")
		Return
	EndIf
	DbSelectArea("SF2")
		DbSetOrder(1)
	//VALIDAÇÃO DE AUTORIZAÇÃO NFE
	If SF2->(dbSetOrder(1), dbSeek(xFilial("SF2")+SE1->E1_NUM+SE1->E1_PREFIXO+SE1->E1_CLIENTE+SE1->E1_LOJA))
	    If Empty(SF2->F2_CHVNFE)
              Msgalert("NF-e "+SE1->E1_NUM +" ainda não transmitida ou não autorizada! Verifique status no Monitor>Faixa.")
              SE1->(Dbskip())
              loop 
		Endif
	Endif
		DbSelectArea("SE1")
		//Posiciona o SA1 (Cliente)
		DbSelectArea("SA1")
		DbSetOrder(1)
		DbSeek(xFilial("SA1")+SE1->E1_CLIENTE+SE1->E1_LOJA,.T.)
	
		DbSelectArea("SE1")
		aDadosBanco := {SA6->A6_COD,;	// [1]Numero do Banco
						SA6->A6_NREDUZ,;	// [2]Nome do Banco
	        	        SUBSTR(SA6->A6_AGENCIA,1,4)+"-"+SUBSTR(SA6->A6_DVAGE,1,1),;	// [3]Agência
                	    SUBSTR(SA6->A6_NUMCON,1,Len(AllTrim(SA6->A6_NUMCON))-1),;	// [4]Conta Corrente
                    	SUBSTR(SA6->A6_NUMCON,Len(AllTrim(SA6->A6_NUMCON)),1),;	// [5]Dígito da conta corrente
	                    "17-035"}	// [6]Codigo da Carteira

		If Empty(SA1->A1_ENDCOB)
			aDatSacado := {Alltrim(SE1->E1_CLIENTE)+"-"+Alltrim(SE1->E1_LOJA)+" - "+Substr(SA1->A1_NOME,1,30),;	// [1]Razão Social
			               AllTrim(SA1->A1_COD)+"-"+SA1->A1_LOJA,;	// [2]Código
                           AllTrim(SA1->A1_END)+"-"+AllTrim(SA1->A1_BAIRRO),;	// [3]Endereço
						   AllTrim(SA1->A1_MUN),;	// [4]Cidade
			    		   SA1->A1_EST,;	// [5]Estado
						   SA1->A1_CEP,;	// [6]CEP
			     	       SA1->A1_CGC,;	// [7]CGC
						   SA1->A1_PESSOA}	// [8]PESSOA
		Else
			aDatSacado := {Alltrim(SE1->E1_CLIENTE)+"-"+Alltrim(SE1->E1_LOJA)+" - "+Substr(SA1->A1_NOME,1,34),;	// [1]Razão Social
						   AllTrim(SA1->A1_COD)+"-"+SA1->A1_LOJA,;	// [2]Código
						   AllTrim(SA1->A1_ENDCOB)+"-"+AllTrim(SA1->A1_BAIRROC),;	// [3]Endereço
						   AllTrim(SA1->A1_MUNC),;	// [4]Cidade
						   SA1->A1_ESTC,;	// [5]Estado
						   SA1->A1_CEPC,;	// [6]CEP
						   SA1->A1_CGC,;	// [7]CGC
						   SA1->A1_PESSOA}	// [8]PESSOA
		Endif
	
		nVlrAbat   :=  SomaAbat(SE1->E1_PREFIXO,SE1->E1_NUM,SE1->E1_PARCELA,"R",1,,SE1->E1_CLIENTE,SE1->E1_LOJA) 
	//	nVlrAbat   += SE1->E1_DECRESC  //VALOR DECRESCIMO - ALTERADO POR WEIDEN 30/04/13

		//Aqui defino parte do nosso numero. Sao 17 digitos para convênio com 7 posições
	IF  ALLTRIM(SE1->E1_NUMBCO) == "" .AND. LEN(SE1->E1_NUMBCO)==17 //ALTERADO POR WEIDEN - 19/02/16
		cNroDoc	:= "2956427" + STRZERO(VAL(SE1->E1_NUM),8)+STRZERO(VAL(SE1->E1_PARCELA),2)
	ELSE
		cNroDoc := SE1->E1_NUMBCO
	ENDIF

//Posiciona o SD2 (Nota Fiscal)
		DbSelectArea("SD2")
		DbSetOrder(3)
		DbSeek(xFilial("SD2")+SE1->E1_NUM+SE1->E1_PREFIXO,.T.)

//**********************************/
//** //Alterado Weiden 13/03/14		/
//**********************************/
nValST := SE1->E1_STANT

		DbSelectArea("SE1")
		
			//Monta codigo de barras
	//	aCB_RN_NN := Ret_cBarra(SE1->E1_PREFIXO, SE1->E1_NUM, SE1->E1_PARCELA, SE1->E1_TIPO,;
		//				        Subs(aDadosBanco[1],1,3), aDadosBanco[3], aDadosBanco[4], aDadosBanco[5],;
			//		        cNroDoc, (E1_VALOR-nVlrAbat), "17","9")
		
	//Monta codigo de barras - ALTERADO POR WEIDEN - 13/03/14
		aCB_RN_NN := Ret_cBarra(SE1->E1_PREFIXO, SE1->E1_NUM, SE1->E1_PARCELA, SE1->E1_TIPO,;
						        Subs(aDadosBanco[1],1,3), aDadosBanco[3], aDadosBanco[4], aDadosBanco[5],;
						        cNroDoc, (E1_SALDO-nVlrAbat), "17","9")
						        
						        
		If Val(E1_PREFIXO) <= 0
			cPrefixo := E1_PREFIXO
		Else
			cPrefixo := StrZero(Val(E1_PREFIXO),3) 
		Endif
		
		aDadosTit := {AllTrim(E1_NUM)+AllTrim(E1_PARCELA),;	//[1]Número do título
					  E1_EMISSAO,;							//[2]Data da emissão do título
					  dDataBase,;							//[3]Data da emissão do boleto
					  E1_VENCTO,;							//[4]Data do vencimento
					  (E1_SALDO - nVlrAbat),;		//[5]Valor do título
			   		  cNroDoc,;								//[6]Nosso número (Ver fórmula para calculo)
					  E1_PREFIXO,;							//[7]Prefixo da NF
					  E1_TIPO,;								//[8]Tipo do Titulo
					  E1_INSTR2,;                          //[9]Instrução de Protesto
					  nValST,;                             //[10]Valor ST    //Alterado Weiden 13/03/14
					  (E1_SALDO - nVlrAbat)}	   //[11]Valor Cobrado //Alterado Weiden 13/03/14
	
		DbSelectArea("SE1")

		If Marked("E1_OK")
			Impress(oPrint,aDadosEmp,aDadosTit,aDadosBanco,aDatSacado,aBolText,aCB_RN_NN)
			nX := nX + 1
		EndIf
		dbSkip()

		nI++
	
	EndDo
	oPrint:EndPage()     // Finaliza a página
	oPrint:Preview()     // Visualiza antes de imprimir
	
Return nil

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³  Impress ³ Autor ³ Microsiga             ³ Data ³ 13/10/03 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri??o ³ IMPRESSAO DO BOLETO LASERDO ITAU COM CODIGO DE BARRAS      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³ Especifico para Clientes Microsiga                         ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function Impress(oPrint,aDadosEmp,aDadosTit,aDadosBanco,aDatSacado,aBolText,aCB_RN_NN)

	LOCAL oFont8
	LOCAL oFont11c
	LOCAL oFont10
	LOCAL oFont14
	LOCAL oFont16n
	LOCAL oFont15
	LOCAL oFont14n
	LOCAL oFont24
	LOCAL nI := 0
	
	//Parametros de TFont.New()
	//1.Nome da Fonte (Windows)
	//3.Tamanho em Pixels
	//5.Bold (T/F)
	oFont8   := TFont():New("Arial",9,8,.T.,.F.,5,.T.,5,.T.,.F.)
	oFont11c := TFont():New("Courier New",9,11,.T.,.T.,5,.T.,5,.T.,.F.)
	oFont11  := TFont():New("Arial",9,11,.T.,.T.,5,.T.,5,.T.,.F.)
	oFont10  := TFont():New("Arial",9,10,.T.,.T.,5,.T.,5,.T.,.F.)
	oFont14  := TFont():New("Arial",9,14,.T.,.T.,5,.T.,5,.T.,.F.)
	oFont20  := TFont():New("Arial",9,20,.T.,.T.,5,.T.,5,.T.,.F.)
	oFont21  := TFont():New("Arial",9,21,.T.,.T.,5,.T.,5,.T.,.F.)
	oFont16n := TFont():New("Arial",9,16,.T.,.F.,5,.T.,5,.T.,.F.)
	oFont15  := TFont():New("Arial",9,15,.T.,.T.,5,.T.,5,.T.,.F.)
	oFont15n := TFont():New("Arial",9,15,.T.,.F.,5,.T.,5,.T.,.F.)
	oFont14n := TFont():New("Arial",9,14,.T.,.F.,5,.T.,5,.T.,.F.)
	oFont24  := TFont():New("Arial",9,24,.T.,.T.,5,.T.,5,.T.,.F.)
	
	oPrint:StartPage()	//Inicia uma nova página

	/******************/
	/* PRIMEIRA PARTE */
	/******************/
	
	nRow1 := 0
	 
	oPrint:Line (0150,0500,0070,0500)
	oPrint:Line (0150,0710,0070,0710)
	
	oPrint:Say (0084,0100,"Banco do Brasil"  ,oFont11)	//[2]Nome do Banco
	oPrint:Say (0075,0513,aDadosBanco[1]+"-9",oFont21)	//[1]Numero do Banco
	
	oPrint:Say  (nRow1+0084,1900,"Comprovante de Entrega",oFont10)
	oPrint:Line (nRow1+0150,0100,nRow1+0150,2300)
	
	
	oPrint:Say (nRow1+0150,0100,"Cedente"   ,oFont8)
	oPrint:Say (nRow1+0200,0100,Substr(aDadosEmp[1],1,42),oFont10)	//Nome + CNPJ
	
	oPrint:Say (nRow1+0150,1060,"Agência/Código Cedente"                            ,oFont8)
	oPrint:Say (nRow1+0200,1060,aDadosBanco[3]+"/"+aDadosBanco[4]+"-"+aDadosBanco[5],oFont10)
	
	oPrint:Say (nRow1+0150,1510,"Nro.Documento"          ,oFont8)
//	oPrint:Say (nRow1+0200,1510,aDadosTit[7]+aDadosTit[1],oFont10)	//Prefixo+Numero+Parcela
	oPrint:Say (nRow1+0200,1510,aDadosTit[1]             ,oFont10)	//Numero
	
	oPrint:Say (nRow1+0250,100,"Sacado"     ,oFont8)
	oPrint:Say (nRow1+0300,100,aDatSacado[1],oFont10)	//Nome

	oPrint:Say (nRow1+0350,0100,aDatSacado[4]+" - "+aDatSacado[5],oFont10)  //Cidade - Estado / Alterado por Weiden(25/05/11)
	
	oPrint:Say (nRow1+0250,1060,"Vencimento"                                                                                        ,oFont8)
	oPrint:Say (nRow1+0300,1060,StrZero(Day(aDadosTit[4]),2)+"/"+StrZero(Month(aDadosTit[4]),2)+"/"+Right(Str(Year(aDadosTit[4])),4),oFont10)
	
	oPrint:Say (nRow1+0250,1510,"Valor do Documento"                                ,oFont8)
	//oPrint:Say (nRow1+0300,1550,AllTrim(Transform(aDadosTit[5],"@E 999,999,999.99")),oFont10)
	oPrint:Say (nRow1+0300,1550,AllTrim(Transform(aDadosTit[11],"@E 999,999,999.99")),oFont10)
	
	oPrint:Say (nRow1+0460,0100,"Recebi(emos) o bloqueto/título",oFont10)
	oPrint:Say (nRow1+0510,0100,"com as características acima." ,oFont10)
	oPrint:Say (nRow1+0350,1060,"Data"                          ,oFont8)
	oPrint:Say (nRow1+0350,1410,"Assinatura"                    ,oFont8)
	oPrint:Say (nRow1+0450,1060,"Data"                          ,oFont8)
	oPrint:Say (nRow1+0450,1410,"Entregador"                    ,oFont8)

	oPrint:Say (nRow1+0600,0100,"Nosso Número:"+aDadosTit[6],oFont10) // Alterado por Weiden - 25/05/11
	
	
// LINHAS HORIZONTAIS	
	oPrint:Line(nRow1+0250,0100,nRow1+0250,1900)
//	oPrint:Line(nRow1+0350,0100,nRow1+0350,1900)
	oPrint:Line(nRow1+0350,1050,nRow1+0350,1900)
	oPrint:Line(nRow1+0450,0100,nRow1+0450,1900) 
//	oPrint:Line(nRow1+0550,0100,nRow1+0550,2300)
	oPrint:Line(nRow1+0650,0100,nRow1+0650,2300)

//LINHAS VERTICAIS
	oPrint:Line(nRow1+0650,1050,nRow1+0150,1050)
	oPrint:Line(nRow1+0650,1400,nRow1+0350,1400)
	oPrint:Line(nRow1+0350,1500,nRow1+0150,1500) 
	oPrint:Line(nRow1+0650,1900,nRow1+0150,1900)

	oPrint:Say (nRow1+0165,1910,"(  )Mudou-se"               ,oFont8)
	oPrint:Say (nRow1+0205,1910,"(  )Ausente"                ,oFont8)
	oPrint:Say (nRow1+0245,1910,"(  )Não existe nº indicado" ,oFont8)
	oPrint:Say (nRow1+0285,1910,"(  )Recusado"               ,oFont8)
	oPrint:Say (nRow1+0325,1910,"(  )Não procurado"          ,oFont8)
	oPrint:Say (nRow1+0365,1910,"(  )Endereço insuficiente"  ,oFont8)
	oPrint:Say (nRow1+0405,1910,"(  )Desconhecido"           ,oFont8)
	oPrint:Say (nRow1+0445,1910,"(  )Falecido"               ,oFont8)
	oPrint:Say (nRow1+0485,1910,"(  )Outros(anotar no verso)",oFont8)
	
	/*****************/
	/* SEGUNDA PARTE */
	/*****************/
	
//	nRow2 := 0
	nRow2 := 200 // Alterado por Weiden - 25/05/11
	
	//Pontilhado separador
	For nI := 100 to 2300 step 50
//		oPrint:Line (0580, nI,0580, nI+30)
		oPrint:Line (nRow2+0580, nI,nRow2+0580, nI+30)  // Alterado por Weiden - 25/05/11
	Next nI
	
	oPrint:Line (nRow2+0710,0100,nRow2+0710,2300)
	oPrint:Line (nRow2+0710,0500,nRow2+0630,0500)
	oPrint:Line (nRow2+0710,0710,nRow2+0630,0710)
	
	oPrint:Say  (nRow2+0644,0100,"Banco do Brasil"  ,oFont11)	//aDadosBanco[2],oFont11)//[2]Nome do Banco
	oPrint:Say  (nRow2+0635,0513,aDadosBanco[1]+"-9",oFont21)	//[1]Numero do Banco
	oPrint:Say  (nRow2+0644,1800,"Recibo do Sacado" ,oFont10)

	oPrint:Line (nRow2+0810,0100,nRow2+0810,2300)
	oPrint:Line (nRow2+0910,0100,nRow2+0910,2300)
	oPrint:Line (nRow2+0980,0100,nRow2+0980,2300)
	oPrint:Line (nRow2+1050,0100,nRow2+1050,2300)

	oPrint:Line (nRow2+0910,0500,nRow2+1050,0500)
	oPrint:Line (nRow2+0980,0750,nRow2+1050,0750)
	oPrint:Line (nRow2+0910,1000,nRow2+1050,1000)
	oPrint:Line (nRow2+0910,1300,nRow2+0980,1300)
	oPrint:Line (nRow2+0910,1480,nRow2+1050,1480)
	
	oPrint:Say (nRow2+0710,0100,"Local de Pagamento"                                    ,oFont8)
	oPrint:Say (nRow2+0725,0400,"ATÉ O VENCIMENTO, PREFERENCIALMENTE NO BANCO DO BRASIL",oFont10)
	oPrint:Say (nRow2+0765,0400,"APÓS O VENCIMENTO, SOMENTE NO BANCO DO BRASIL"         ,oFont10)

	oPrint:Say (nRow2+0710,1810,"Vencimento",oFont8)
	cString	:= StrZero(Day(aDadosTit[4]),2) +"/"+ StrZero(Month(aDadosTit[4]),2) +"/"+ Right(Str(Year(aDadosTit[4])),4)
	nCol    := 1810+(374-(len(cString)*22))
	oPrint:Say (nRow2+0750,nCol,cString,oFont11c)

	oPrint:Say (nRow2+0810,0100,"Cedente"                                 ,oFont8)
	oPrint:Say (nRow2+0850,0100,aDadosEmp[1]+"  - "+aDadosEmp[6],oFont10)	//Nome + CNPJ

	oPrint:Say (nRow2+0810,1810,"Agência/Código Cedente",oFont8)
	cString := Alltrim(aDadosBanco[3]+"/"+aDadosBanco[4]+"-"+aDadosBanco[5])
	nCol 	:= 1832+(374-(len(cString)*22))
	oPrint:Say (nRow2+0850,nCol,cString,oFont11c)

	oPrint:Say (nRow2+0910,0100,"Data do Documento"                                                                                      ,oFont8)
	oPrint:Say (nRow2+0940,0100, StrZero(Day(aDadosTit[2]),2) +"/"+ StrZero(Month(aDadosTit[2]),2) +"/"+ Right(Str(Year(aDadosTit[2])),4),oFont10)
	
	oPrint:Say (nRow2+0910,0505,"Nro.Documento"          ,oFont8)
//	oPrint:Say (nRow2+0940,0605,aDadosTit[7]+aDadosTit[1],oFont10)	//Prefixo+Numero+Parcela
	oPrint:Say (nRow2+0940,0605,aDadosTit[1]             ,oFont10)	//Numero
	
	oPrint:Say (nRow2+0910,1005,"Espécie Doc.",oFont8)
	oPrint:Say (nRow2+0940,1050,"DM"          ,oFont10)	//Tipo do Titulo
	
	oPrint:Say (nRow2+0910,1305,"Aceite",oFont8)
	oPrint:Say (nRow2+0940,1400,"N"     ,oFont10)

	oPrint:Say (nRow2+0910,1485,"Data do Processamento"                                                                             ,oFont8)
	oPrint:Say (nRow2+0940,1550,StrZero(Day(aDadosTit[3]),2)+"/"+StrZero(Month(aDadosTit[3]),2)+"/"+Right(Str(Year(aDadosTit[3])),4),oFont10)	//Data impressao
	
	oPrint:Say (nRow2+0910,1810,"Nosso Número",oFont8)
	//cString := Alltrim(Substr(aDadosTit[6],0,0)+Alltrim(SA6->A6_NUMBCO)+"00"+Substr(aDadosTit[1],1,6)+"0"+Substr(aDadosTit[1],7,1)) //cString := Alltrim(Substr(aDadosTit[6],1,3)+"/"+Substr(aDadosTit[6],4))
	cString := Alltrim(aDadosTit[6])
	nCol    := 1810+(374-(len(cString)*22))
	oPrint:Say (nRow2+0940,nCol,cString,oFont11c)

	oPrint:Say (nRow2+0980,0100,"Uso do Banco",oFont8)

	oPrint:Say (nRow2+0980,0505,"Carteira"    ,oFont8)
	oPrint:Say (nRow2+1010,0555,aDadosBanco[6],oFont10)
	
	oPrint:Say (nRow2+0980,0755,"Espécie",oFont8)
	oPrint:Say (nRow2+1010,0805,"R$"     ,oFont10)
	
	oPrint:Say (nRow2+0980,1005,"Quantidade",oFont8)
	oPrint:Say (nRow2+0980,1485,"Valor"     ,oFont8)
	
	oPrint:Say (nRow2+0980,1810,"Valor do Documento",oFont8)
	cString := Alltrim(Transform(aDadosTit[5],"@E 99,999,999.99"))
	nCol    := 1810+(374-(len(cString)*22))
	oPrint:Say (nRow2+1010,nCol,cString,oFont11c)
	
	oPrint:Say (nRow2+1050,0100,"Instruções (Todas informações deste bloqueto são de exclusiva responsabilidade do cedente)",oFont8)
//	nVlrJuros := NoRound(((aDadosTit[5]*0.07)/30),2)
	nVlrJuros := NoRound((aDadosTit[5]*0.0023),2)
	oPrint:Say (nRow2+1085,0100,"Juros: Valor p/dia atraso: "+ Transform(nVlrJuros,"@E 99,999.99") + " após " + SubStr(DtoS(aDadosTit[4]),7,2) +"/"+ SubStr(DtoS(aDadosTit[4]),5,2) +"/"+ SubStr(DtoS(aDadosTit[4]),1,4),oFont8)
	If aDadosTit[9] == "05"		
		oPrint:Say (nRow2+1120,0100,"PROTESTO NO 5º DIA ÚTIL APÓS VENCIMENTO",oFont10)
	Endif
	/*
	if aDadosTit[10] > 0
		oPrint:Say (nRow2+1145,0100,"Outros Acréscimos ref. a Substituição Tributária paga antecipadamente.",oFont10)
	endif
	*/
	/*oPrint:Say  (nRow2+1150,100 ,aBolText[1]+" "+AllTrim(Transform((aDadosTit[5]*0.02),"@E 99,999.99"))       ,oFont10)
	oPrint:Say  (nRow2+1200,100 ,aBolText[2]+" "+AllTrim(Transform(((aDadosTit[5]*0.01)/30),"@E 99,999.99"))  ,oFont10)
	oPrint:Say  (nRow2+1250,100 ,aBolText[3]                                        ,oFont10)*/
	
	oPrint:Say (nRow2+1150,0100,aBolText[1],oFont10)
	oPrint:Say (nRow2+1200,0100,aBolText[2],oFont10)
	oPrint:Say (nRow2+1250,0100,aBolText[3],oFont10)
	
	oPrint:Say (nRow2+1050,1810,"(-)Desconto/Abatimento",oFont8)
	oPrint:Say (nRow2+1120,1810,"(-)Outras Deduções"    ,oFont8)
	oPrint:Say (nRow2+1190,1810,"(+)Mora/Multa"         ,oFont8)
	oPrint:Say (nRow2+1260,1810,"(+)Outros Acréscimos"  ,oFont8)
	cString := Alltrim(Transform(aDadosTit[10],"@E 99,999,999.99")) //Alterado Weiden 13/03/14
	nCol    := 1810+(374-(len(cString)*22)) //Alterado Weiden 13/03/14
	oPrint:Say (nRow2+1290,nCol,cString,oFont11c) //Alterado Weiden 13/03/14
	
	oPrint:Say (nRow2+1330,1810,"(=)Valor Cobrado"      ,oFont8)
	cString := Alltrim(Transform(aDadosTit[11],"@E 99,999,999.99"))  //Alterado Weiden 13/03/14 
	//cString := Alltrim(Transform(aDadosTit[5],"@E 99,999,999.99"))  //Alterado Weiden 07/04/14
	nCol    := 1810+(374-(len(cString)*22))  //Alterado Weiden 13/03/14
	oPrint:Say (nRow2+1360,nCol,cString,oFont11c) //Alterado Weiden 13/03/14
	
	oPrint:Say (nRow2+1400,0100,"Sacado"                                              ,oFont8)
	oPrint:Say (nRow2+1430,0400,aDatSacado[1]+" ("+aDatSacado[2]+")"                  ,oFont10)
	oPrint:Say (nRow2+1483,0400,aDatSacado[3]                                         ,oFont10)
	oPrint:Say (nRow2+1536,0400,aDatSacado[6]+"    "+aDatSacado[4]+" - "+aDatSacado[5],oFont10)	//CEP+Cidade+Estado
	
	If aDatSacado[8] = "J"
		oPrint:Say (nRow2+1430,1750,"CNPJ: "+TRANSFORM(aDatSacado[7],"@R 99.999.999/9999-99"),oFont10)	//CGC
	Else
		oPrint:Say (nRow2+1430,1750,"CPF: "+TRANSFORM(aDatSacado[7],"@R 999.999.999-99"),oFont10)	//CPF
	EndIf

	oPrint:Say (nRow2+1589,1850,Substr(aDadosTit[6],1,3)+Substr(aDadosTit[6],4),oFont10)
	
	oPrint:Say (nRow2+1605,0100,"Sacador/Avalista"     ,oFont8)
	oPrint:Say (nRow2+1645,1500,"Autenticação Mecânica",oFont8)
	
	oPrint:Line (nRow2+0710,1800,nRow2+1400,1800) 
	oPrint:Line (nRow2+1120,1800,nRow2+1120,2300)
	oPrint:Line (nRow2+1190,1800,nRow2+1190,2300)
	oPrint:Line (nRow2+1260,1800,nRow2+1260,2300)
	oPrint:Line (nRow2+1330,1800,nRow2+1330,2300)
	oPrint:Line (nRow2+1400,0100,nRow2+1400,2300)
	oPrint:Line (nRow2+1640,0100,nRow2+1640,2300)
	
	/******************/
	/* TERCEIRA PARTE */
	/******************/
	
//	nRow3 := 0
	nRow3 := 200 //Alterado por Weiden - 25/05/11
	
	For nI := 100 to 2300 step 50
		oPrint:Line(nRow3+1880, nI, nRow3+1880, nI+30)
	Next nI
	
	oPrint:Line (nRow3+2000,0100,nRow3+2000,2300)
	oPrint:Line (nRow3+2000,0500,nRow3+1920,0500)
	oPrint:Line (nRow3+2000,0710,nRow3+1920,0710)
	
	oPrint:Say (nRow3+1934,0100,"Banco do Brasil"  ,oFont11)	//aDadosBanco[2],oFont11)//[2]Nome do Banco
	oPrint:Say (nRow3+1925,0513,aDadosBanco[1]+"-9",oFont21)	//[1]Numero do Banco
	oPrint:Say (nRow3+1934,0755,aCB_RN_NN[2]       ,oFont15n)	//Linha Digitavel do Codigo de Barras
	
	oPrint:Line (nRow3+2100,0100,nRow3+2100,2300)
	oPrint:Line (nRow3+2200,0100,nRow3+2200,2300)
	oPrint:Line (nRow3+2270,0100,nRow3+2270,2300)
	oPrint:Line (nRow3+2340,0100,nRow3+2340,2300)
	
	oPrint:Line (nRow3+2200,0500,nRow3+2340,0500)
	oPrint:Line (nRow3+2270,0750,nRow3+2340,0750)
	oPrint:Line (nRow3+2200,1000,nRow3+2340,1000)
	oPrint:Line (nRow3+2200,1300,nRow3+2270,1300)
	oPrint:Line (nRow3+2200,1480,nRow3+2340,1480)
	
	oPrint:Say (nRow3+2000,0100,"Local de Pagamento"                                    ,oFont8)
	oPrint:Say (nRow3+2015,0400,"ATÉ O VENCIMENTO, PREFERENCIALMENTE NO BANCO DO BRASIL",oFont10)
	oPrint:Say (nRow3+2055,0400,"APÓS O VENCIMENTO, SOMENTE NO BANCO DO BRASIL"         ,oFont10)
	           
	oPrint:Say (nRow3+2000,1810,"Vencimento",oFont8)
	cString := StrZero(Day(aDadosTit[4]),2)+"/"+StrZero(Month(aDadosTit[4]),2)+"/"+Right(Str(Year(aDadosTit[4])),4)
	nCol    := 1810+(374-(len(cString)*22))
	oPrint:Say (nRow3+2040,nCol,cString,oFont11c)
	
	oPrint:Say (nRow3+2100,0100,"Cedente"                                 ,oFont8)
	oPrint:Say (nRow3+2140,0100,aDadosEmp[1]+" - "+aDadosEmp[6],oFont10)//Nome + CNPJ
	
	oPrint:Say (nRow3+2100,1810,"Agência/Código Cedente",oFont8)
	cString := Alltrim(aDadosBanco[3]+"/"+aDadosBanco[4]+"-"+aDadosBanco[5])
	nCol 	:= 1832+(374-(len(cString)*22))
	oPrint:Say (nRow3+2140,nCol,cString,oFont11c)
	
	oPrint:Say (nRow3+2200,0100,"Data do Documento"                                                                                 ,oFont8)
	oPrint:Say (nRow3+2230,0100,StrZero(Day(aDadosTit[2]),2)+"/"+StrZero(Month(aDadosTit[2]),2)+"/"+Right(Str(Year(aDadosTit[2])),4),oFont10)	

	oPrint:Say (nRow3+2200,0505,"Nro.Documento"          ,oFont8)
//	oPrint:Say (nRow3+2230,0605,aDadosTit[7]+aDadosTit[1],oFont10)	//Prefixo+Numero+Parcela
	oPrint:Say (nRow3+2230,0605,aDadosTit[1]             ,oFont10)	//Numero
	
	oPrint:Say (nRow3+2200,1005,"Espécie Doc.",oFont8)
	oPrint:Say (nRow3+2230,1050,"DM"          ,oFont10)	//Tipo do Titulo
	
	oPrint:Say (nRow3+2200,1305,"Aceite",oFont8)
	oPrint:Say (nRow3+2230,1400,"N"     ,oFont10)
	
	oPrint:Say (nRow3+2200,1485,"Data do Processamento"                                                                             ,oFont8)
	oPrint:Say (nRow3+2230,1550,StrZero(Day(aDadosTit[3]),2)+"/"+StrZero(Month(aDadosTit[3]),2)+"/"+Right(Str(Year(aDadosTit[3])),4),oFont10)// Data impressao
	
	oPrint:Say (nRow3+2200,1810,"Nosso Número",oFont8)
	//cString := Alltrim(Substr(aDadosTit[6],0,0)+"029168900"+Substr(aDadosTit[1],1,6)+"0"+Substr(aDadosTit[1],7,1)) //cString := Alltrim(Substr(aDadosTit[6],1,3)+"/"+Substr(aDadosTit[6],4))
	//cString := Alltrim(Substr(aDadosTit[6],0,0)+ALLTRIM(SA6->A6_NUMBCO)+"0"+Substr(aDadosTit[1],1,6)+"0"+Substr(aDadosTit[1],7,1)) //cString := Alltrim(Substr(aDadosTit[6],1,3)+"/"+Substr(aDadosTit[6],4))
	cString := Alltrim(aDadosTit[6]) //aCB_RN_NN[3]

	nCol := 1810+(374-(len(cString)*22))
	oPrint:Say (nRow3+2230,nCol,cString,oFont11c)

	oPrint:Say (nRow3+2270,0100,"Uso do Banco",oFont8)

	oPrint:Say (nRow3+2270,0505,"Carteira"    ,oFont8)
	oPrint:Say (nRow3+2300,0555,aDadosBanco[6],oFont10)
	
	oPrint:Say (nRow3+2270,0755,"Espécie",oFont8)
	oPrint:Say (nRow3+2300,0805,"R$"     ,oFont10)

	oPrint:Say (nRow3+2270,1005,"Quantidade",oFont8)
	oPrint:Say (nRow3+2270,1485,"Valor"     ,oFont8)
	
	oPrint:Say (nRow3+2270,1810,"Valor do Documento",oFont8)
	cString := Alltrim(Transform(aDadosTit[5],"@E 99,999,999.99"))
	nCol    := 1810+(374-(len(cString)*22))
	oPrint:Say (nRow3+2300,nCol,cString,oFont11c)

	oPrint:Say (nRow3+2340,0100,"Instruções (Todas informações deste bloqueto são de exclusiva responsabilidade do cedente)",oFont8)
	nVlrJuros := NoRound(((aDadosTit[5]*0.07)/30),2)
	oPrint:Say (nRow3+2375,0100,"Juros: Valor p/dia atraso: "+ Transform(nVlrJuros,"@E 99,999.99") + " após " + SubStr(DtoS(aDadosTit[4]),7,2) +"/"+ SubStr(DtoS(aDadosTit[4]),5,2) +"/"+ SubStr(DtoS(aDadosTit[4]),1,4),oFont8)
	If aDadosTit[9] == "05"
		oPrint:Say (nRow3+2410,0100,"PROTESTO NO 5º DIA ÚTIL APÓS VENCIMENTO",oFont10)
	Endif
	/*
	if aDadosTit[10] > 0
		oPrint:Say (nRow2+2445,0100,"Outros Acréscimos ref. a Substituição Tributária paga antecipadamente.",oFont10)
	endif
	*/
	/*oPrint:Say  (nRow3+2440,100 ,aBolText[1]+" "+AllTrim(Transform((aDadosTit[5]*0.02),"@E 99,999.99"))      ,oFont10)
	oPrint:Say  (nRow3+2490,100 ,aBolText[2]+" "+AllTrim(Transform(((aDadosTit[5]*0.01)/30),"@E 99,999.99"))  ,oFont10)
	oPrint:Say  (nRow3+2540,100 ,aBolText[3]                                        ,oFont10)*/
	
	oPrint:Say (nRow3+2440,0100,aBolText[1],oFont10)
	oPrint:Say (nRow3+2490,0100,aBolText[2],oFont10)
	oPrint:Say (nRow3+2540,0100,aBolText[3],oFont10)
	
	oPrint:Say (nRow3+2340,1810,"(-)Desconto/Abatimento",oFont8)
	oPrint:Say (nRow3+2410,1810,"(-)Outras Deduções"    ,oFont8)
	oPrint:Say (nRow3+2480,1810,"(+)Mora/Multa"         ,oFont8)
	oPrint:Say (nRow3+2550,1810,"(+)Outros Acréscimos"  ,oFont8)
	cString := Alltrim(Transform(aDadosTit[10],"@E 99,999,999.99")) //Alterado Weiden 13/03/14
	nCol    := 1810+(374-(len(cString)*22)) //Alterado Weiden 13/03/14
	oPrint:Say (nRow3+2550,nCol,cString,oFont11c) //Alterado Weiden 13/03/14
	oPrint:Say (nRow3+2620,1810,"(=)Valor Cobrado"      ,oFont8)
		cString := Alltrim(Transform(aDadosTit[11],"@E 99,999,999.99"))  //Alterado Weiden 13/03/14 
	//cString := Alltrim(Transform(aDadosTit[5],"@E 99,999,999.99"))  //Alterado Weiden 07/04/14
	nCol    := 1810+(374-(len(cString)*22))  //Alterado Weiden 13/03/14
	oPrint:Say (nRow3+2630,nCol,cString,oFont11c) //Alterado Weiden 13/03/14
	
	oPrint:Say (nRow3+2690,0100,"Sacado"                            ,oFont8)
	oPrint:Say (nRow3+2700,0400,aDatSacado[1]+" ("+aDatSacado[2]+")",oFont10)
	
	if aDatSacado[8] = "J"
		oPrint:Say (nRow3+2700,1750,"CNPJ: "+TRANSFORM(aDatSacado[7],"@R 99.999.999/9999-99"),oFont10)	//CGC
	Else
		oPrint:Say (nRow3+2700,1750,"CPF: "+TRANSFORM(aDatSacado[7],"@R 999.999.999-99"),oFont10)	//CPF
	EndIf
	
	oPrint:Say (nRow3+2753,0400,aDatSacado[3]                                         ,oFont10)
	oPrint:Say (nRow3+2806,0400,aDatSacado[6]+"    "+aDatSacado[4]+" - "+aDatSacado[5],oFont10)	//CEP+Cidade+Estado
	oPrint:Say (nRow3+2806,1850,Substr(aDadosTit[6],1,3)+Substr(aDadosTit[6],4)       ,oFont10)
	
	oPrint:Say (nRow3+2815,0100,"Sacador/Avalista"                            ,oFont8)
	oPrint:Say (nRow3+2855,1500,"Autenticação Mecânica - Ficha de Compensação",oFont8)
	
	oPrint:Line (nRow3+2000,1800,nRow3+2690,1800)
	oPrint:Line (nRow3+2410,1800,nRow3+2410,2300)
	oPrint:Line (nRow3+2480,1800,nRow3+2480,2300)
	oPrint:Line (nRow3+2550,1800,nRow3+2550,2300)
	oPrint:Line (nRow3+2620,1800,nRow3+2620,2300)
	oPrint:Line (nRow3+2690,0100,nRow3+2690,2300)
	
	//Retirando os "." e " " da linha digitável para gerar o código de barras
	//cString := StrTran(aCB_RN_NN[2],".","",0,)
	//cString := StrTran(cString," ","",0,) 
    cCodBarras := aCB_RN_NN[1]	
//	MSBAR3("INT25",12.5,0.8,cCodBarras,oPrint,.F.,,.T.,0.028,1.3,nil,nil,nil,.F.) ANTIGO
//	MSBAR3("INT25",24.5,0.8,cCodBarras,oPrint,.F.,,.T.,0.028,1.3,nil,nil,nil,.F.) RENATA
	MSBAR3("INT25",26,0.8,cCodBarras,oPrint,.F.,,.T.,0.028,1.3,nil,nil,nil,.F.) //Alterado por Weiden - 25/05/11
	
	oPrint:Line (nRow3+2850,100,nRow3+2850,2300)

	For nI := 100 to 2300 step 50
		oPrint:Line(nRow3+3150,nI,nRow3+3150,nI+30)
	Next nI
	
	DbSelectArea("SE1")
	RecLock("SE1",.f.)
		SE1->E1_NUMBCO := aCB_RN_NN[3]	//Nosso número (Ver fórmula para calculo)
	   	//SE1->E1_PORTADO := "001"
	   	SE1->E1_HIST := "BOLETO BB GERADO"
	   	//Alterado weiden - 13/11/14
	   	SE1->E1_IDCNAB:= Substr(E1_NUMBCO,8,10)
	MsUnlock()
	
	oPrint:EndPage() // Finaliza a página
	
Return Nil

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³RetDados  ºAutor  ³Microsiga           º Data ³  02/13/04   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Gera SE1                        					          º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ BOLETOS                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function Ret_cBarra(cPrefixo, cNumero, cParcela ,cTipo,;
						   cBanco, cAgencia, cConta, cDacCC,;
						   cNroDoc, nValor, cCart, cMoeda)

	Local cNosso	  := ""
	Local cDigNosso	  := ""
	Local _NNUM		  := ""
	Local cCampoL	  := ""
	Local cFatorValor := ""
	Local cLivre	  := ""
	Local cDigBarra	  := ""
	Local cBarra	  := ""
	Local cParte1	  := ""
	Local cDig1		  := ""
	Local cParte2	  := ""
	Local cDig2		  := ""
	Local cParte3	  := ""
	Local cDig3		  := ""
	Local cParte4	  := ""
	Local cParte5	  := ""
	Local cDigital	  := ""
	Local aRet		  := {}
	
	cAgencia:=STRZERO(Val(cAgencia),4)
	cCart := "17"		
	cNosso := ""

	//Nosso Numero
	If !Empty(SE1->E1_NUMBCO)
		_nNum  := ALLTRIM(SE1->E1_NUMBCO)
		cNosso := ALLTRIM(SE1->E1_NUMBCO)
	Else
		cNosso := cNroDoc
	   	_nNum  := cNroDoc
	   
	   	Reclock("SE1",.F.)
			SE1->E1_NUMBCO := cNosso
	   	MsUnlock()                
	EndIf                  
	
	//cNosso := STRZERO(VAL(cnumero),10) //acrescentar a parcela no número
	_nNum := cNroDoc                  
		
	If nValor > 0
		cFatorValor := u_fatord()+Strzero(nValor*100,10)
	Else
		cFatorValor := u_fatord()+strzero(SE1->E1_VALOR*100,10)
	EndIf
	
	cConvenio := ALLTRIM(SA6->A6_NUMBCO) 
	
	//cCampoL := "000000"+cConvenio+alltrim(NNUM)+cCart  // CAIO 09/06/06                                       
	// ALTERADO POR ROBERTO R.MEZZALIRA
	
	DO CASE 
	  CASE LEN(ALLTRIM(cConvenio)) == 6
	     cCampoL := cConvenio+alltrim(_NNUM)+"21"
	  CASE LEN(ALLTRIM(cConvenio)) == 7
	     cCampoL := "000000"+alltrim(_NNUM)+cCart   
	ENDCASE
  
	cLivre := cBanco+cMoeda+cFatorValor+cCampoL

	//Código de Barra
	cLivre := cBanco+cMoeda+cFatorValor+cCampoL

	//Cálculo do dígito verificador base 11
	cDigBarra := U_CALC_Dp(cLivre)
	
	//cBarra := Substr(cLivre,1,4)+cDigBarra+cFatorValor+Substr(cCampoL,1,25)
	cBarra := cBanco+cMoeda+cDigBarra+cFatorValor+cCampoL
	
	// composicao da linha digitavel
	cParte1  := cBanco+cMoeda
	cParte1  += SUBSTR(cBarra,20,5) //SUBSTR(cCampoL,20,5) //SUBSTR(cCampoL,1,5)
	cDig1    := U_DIGIT0001(cParte1,1)
	cParte2  := SUBSTR(cBarra,25,10) //SUBSTR(cCampoL,6,10)
	cDig2    := U_DIGIT0001(cParte2,2)
	cParte3  := SUBSTR(cBarra,35,10) //SUBSTR(cCampoL,6,29)//10
	cDig3    := U_DIGIT0001(cParte3,2)
	cParte4  := cDigBarra //" "+cDigBarra+" "
	cParte5  := cFatorValor
	
	cDigital := substr(cParte1,1,5)+"."+substr(cparte1,6,4)+cDig1+" "+;
				substr(cParte2,1,5)+"."+substr(cparte2,6,5)+cDig2+" "+;
				substr(cParte3,1,5)+"."+substr(cparte3,6,5)+cDig3+" "+;
				cParte4+" "+;                                              
				cParte5	
	
	Aadd(aRet,cBarra)
	Aadd(aRet,cDigital)
	Aadd(aRet,cNosso)		
	
Return aRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³CALC_diE  ºAutor  ³Microsiga           º Data ³  02/13/04   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Para calculo do nosso numero do banco do brasil             º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ BOLETOS                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
User Function CALC_diE(cVariavel)

	Local Auxi := 0, sumdig := 0
	
	cbase  := cVariavel
	lbase  := LEN(cBase)
	base   := 9
	sumdig := 0
	Auxi   := 0
	iDig   := lBase
	
	While iDig >= 1
		If base == 1
			base := 9
		EndIf
		auxi   := Val(SubStr(cBase, idig, 1)) * base
		sumdig := SumDig+auxi
		base   := base - 1
		iDig   := iDig-1
	EndDo
	
	auxi := mod(Sumdig,11)
	If auxi == 10
		auxi := "X"
	Else
		auxi := str(auxi,1,0)
	EndIf
	
Return(auxi)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³DIGIT0001  ºAutor  ³Microsiga           º Data ³  02/13/04   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Para calculo da linha digitavel do Banco do Brasil          º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ BOLETOS                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
User Function DIGIT0001(cVariavel,nOp)

	//Local Auxi := 0, sumdig := 0Local _aArea     := GetArea()
	local aMultiplic := {}  // Resultado das Multiplicacoes de cada algarismo
	local _cRet      := " "
	local aBaseNum   := {}
	local cDigVer    := 0 
	local nB         := 0  
	local nC         := 0 
	local nSum       := 0 
	local _cNossoNum := ""
	local _cCalcdig  := ""
	cbase  := cVariavel 
	IF nOp == 1 
		aBaseNum := { 2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2}
	ELSE
		aBaseNum := { 1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1}
	ENDIF

	For nB := 1 To Len(cbase)		
		nMultiplic := Val(Subs(cbase,nB,1) ) * aBaseNum[nB]
		Aadd(aMultiplic,StrZero(nMultiplic,2) )		
	next nB
	For nC := 1 To Len(aMultiplic)
		nAlgarism1 := Val(Subs(aMultiplic[nC],1,1) )
		nAlgarism2 := Val(Subs(aMultiplic[nC],2,1) )
		nSum       := nSum + nAlgarism1 + nAlgarism2
	Next nC
	
	cDigVer := 10 - Mod(nSum,10)
	
	IF cDigVer == 10 
		cDigVer := 0 
	Endif

Return(str(cDigVer,1,0))

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³FATOR		ºAutor  ³Microsiga           º Data ³  02/13/04   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Calculo do FATOR1  de vencimento para linha digitavel.       º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ BOLETOS                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
User function Fator1()

	If Len(ALLTRIM(SUBSTR(DTOC(SE1->E1_VENCTO),7,4))) = 4
		cData := SUBSTR(DTOC(SE1->E1_VENCTO),7,4)+SUBSTR(DTOC(SE1->E1_VENCTO),4,2)+SUBSTR(DTOC(SE1->E1_VENCTO),1,2)
	Else
		cData := "20"+SUBSTR(DTOC(SE1->E1_VENCTO),7,2)+SUBSTR(DTOC(SE1->E1_VENCTO),4,2)+SUBSTR(DTOC(SE1->E1_VENCTO),1,2)
	EndIf
	cFator := STR(1000+(STOD(cData)-STOD("20000703")),4)
	//cFator := STR(1000+(SE1->E1_VENCREA-STOD("20000703")),4)

Return(cFator)

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³CALC_Dp   ºAutor  ³Microsiga           º Data ³  02/13/04   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Calculo do digito do nosso numero do                        º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ BOLETOS                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
User Function CALC_Dp(cVariavel)
	
	Local Auxi      := 0, sumdig := 0
	Local aBasecalc := { 4,3,2,9,8,7,6,5,4,3,2,9,8,7,6,5,4,3,2,9,8,7,6,5,4,3,2,9,8,7,6,5,4,3,2,9,8,7,6,5,4,3,2}
	Local nMult     := 0
	Local nD        := 0      
	Local nE        := 0      
	Local aMult     := {}
	Local nDigbar   := 0
	Local nSoma     := 0
	cbase  := cVariavel
	
	For nD := 1 To Len(cbase)
		nMult := Val(Subs(cbase,nD,1) ) * aBasecalc[nD]
		Aadd(aMult,StrZero(nMult,2) )
	next nD   
	
	nSoma := 0 
	nAlgarism1 := 0 
	nAlgarism2 := 0 
	For nE := 1 To Len(aMult)                         
	    nAlgarism1 := Val(aMult[nE])
		nSoma      := nSoma + nAlgarism1 // + nAlgarism2
	Next nC
	nDigbar := 11 - Mod(nSoma,11)
	
	IF nDigbar == 0  .or. nDigbar == 1 .or. nDigbar == 10 .or. nDigbar == 11   
	   nDigbar := 1 
	Endif 
  
Return(str(nDigbar,1,0))

Static function LimpaFlag(cNFDe,cNFAte,cSrDe,cSrAte)

	DbSelectArea("SE1")
	DbSetOrder(1)
	DbSeek(xFilial("SE1")+cSrDe+cNfDe,.T. )

	ProcRegua(RecCount())

	While SE1->(!Eof()) .And. SE1->E1_NUM <= cNFAte
    	
		IncProc("Limpando Flag.." )
   
		Reclock("SE1",.F.)
			SE1->E1_OK := Space(2)
		MsUnlock()
   		DbSkip()
	
	Enddo

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºFuncao    ³FATOR		ºAutor  ³Microsiga           º Data ³  02/13/04   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³Calculo do FATORD  de vencimento para linha digitavel.       º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ BOLETOS                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
User function Fatord()

	If Len(ALLTRIM(SUBSTR(DTOC(SE1->E1_VENCTO),7,4))) = 4
		cData := SUBSTR(DTOC(SE1->E1_VENCTO),7,4)+SUBSTR(DTOC(SE1->E1_VENCTO),4,2)+SUBSTR(DTOC(SE1->E1_VENCTO),1,2)
	Else
		cData := "20"+SUBSTR(DTOC(SE1->E1_VENCTO),7,2)+SUBSTR(DTOC(SE1->E1_VENCTO),4,2)+SUBSTR(DTOC(SE1->E1_VENCTO),1,2)
	EndIf
	cFator := STR((STOD(cData)-STOD("19971007")),4)
	//cFator := STR(1000+(SE1->E1_VENCREA-STOD("20000703")),4)

Return(cFator)